# IO (Input/Output)

- Input과 Output의 약자로 컴퓨터 내부 또는 외부 장치와 프로그램 간의 데이터를 주고받는 것을 입출력(IO)이라 한다.
- 데이터는 키보드, 파일 또는 네트워크로부터 입력될 수 있고 모니터, 파일 또는 네트워크로 출력 될 수 있다.

## 스트림

- 자바에서 스트림은 입출력 장치에 데이터를 읽고 쓰기 위해서 제공하는 클래스이다.

- 스트림을 통해서 다양한 장치로부터 데이터 입출력에 대해 **동일한 처리 방법**을 제공한다.

- 모든 스트림은 **단방향**이며 각각의 장치마다 연결할 수 있는 스트림아 존재한다.

- 프로그램 기준으로, 데이터가 들어오면 입력 스트림, 데이터가 나가면 출력 스트림이다.

### InputStream

- **바이트 기반** 입력 스트림의 최상위 클래스로 추상 클래스이다.
    - 데이터가 들어올 때 1바이트 단위로 들어옴
    
- InputStream 스트림은 그림, 멀티미디어, 문자 등 모든 데이터를 입력받을 수 있다.

- InputStream을 상속받는 클래스들은 접미사로 InputStream이 붙는다.
    
    | 최상위 클래스 | 하위 클래스 |
    | --- | --- |
    | InputStream | FileInputStream |
    | InputStream | PipedInputStream |
    | InputStream | DataInputStream |
    | InputStream | BufferedInputStream |
    | InputStream | StringBufferedInputStream |
    | InputStream | ObjectInputStream |

- 외부 장치로부터 바이트 단위의 데이터를 읽어 올 수 있는 `read()` 추상 메소드가 정의되어 있다.

    | 리턴 타입 | 메소드 |
    | --- | --- |
    | int | read() |
    | int | read(byte[] b) |
    | int | read(byte[] b, int off, int len) |
    | void | close() |

- 사용한 시스템 자원 반납 후 입력 스트림을 닫는 `close()` 추상 메소드가 정의되어 있다.

### OutputStream

- **바이트 기반** 출력 스트림의 최상위 클래스로 추상 클래스이다.

- OutputStream 스트림은 그림, 멀티미디어, 문자 등 모든 데이터를 출력할 수 있다.

- OutputStream을 상속받는 클래스들은 접미사로 OutputStream이 붙는다.
    
    
    | 최상위 클래스 | 하위 클래스 |
    | --- | --- |
    | OutputStream | FileOutputStream |
    | OutputStream | PipedOutputStream |
    | OutputStream | DataOutputStream |
    | OutputStream | BufferedOutputStream |
    | OutputStream | PrintStream |
    | OutputStream | ObjectOutputStream |

- 바이트 단위의 데이터를 외부 장치에 기록할 수 있는 `write()` 추상 메소드가 정의되어 있다.
    
    
    | 리턴 타입 | 메소드 |
    | --- | --- |
    | void | write(int b) |
    | void | write(byte[] b) |
    | void | write(byte[] b, int off, int len) |

- 버퍼에 잔류하는 모든 바이트를 출력하는 `flush()` 추상 메소드가 정의되어 있다.

- 사용한 시스템 자원 반납 후 출력 스트림을 닫는 `close()` 추상 메소드가 정의되어 있다.

### Reader

- **문자 기반** 입력 스트림의 최상위 클래스로 추상 클래스이다.

- Reader는 문자 데이터만 입력받을 수 있다.

- Reader를 상속받는 클래스들은 접미사로 Reader가 붙는다.
    
    | 최상위 클래스 | 하위 클래스 |
    | --- | --- |
    | Reader | BufferedReader |
    | Reader | CharArrayReader |
    | Reader | InputStreamReader |
    | Reader | FileReader |
    | Reader | PipedReader |
    | Reader | StringReader |

- 외부 장치로부터 문자 단위의 데이터를 읽어 올 수 있는 `read()` 추상 메소드가 정의되어 있다.
    
    | 리턴 타입 | 메소드 |
    | --- | --- |
    | int | read() |
    | int | read(char[] c) |
    | int | read(char[] c, int off, int len) |
    | void | close() |
    
- 사용한 시스템 자원 반납 후 입력 스트림을 닫는 `close()` 추상 메소드가 정의되어 있다.

### Writer

- **문자 기반** 출력 스트림의 최상위 클래스로 추상 클래스이다.

- Writer는 문자 데이터만 출력할 수 있다.

- Writer를 상속받는 클래스들은 접미사로 Writer가 붙는다.
    
    | 최상위 클래스 | 하위 클래스 |
    | --- | --- |
    | Writer | BufferedWriter |
    | Writer | CharArrayWriter |
    | Writer | OutputStreamWriter |
    | Writer | FileWriter |
    | Writer | PipedWriter |
    | Writer | StringWriter |

- 문자 단위의 데이터를 외부 장치에 기록할 수 있는 `write()` 추상 메소드가 정의되어 있다.
    - 문자 기반이기 때문에 문자열 기반 기록도 가능하다.
    
    | 리턴 타입 | 메소드 |
    | --- | --- |
    | void | write(int c) |
    | void | write(char[] c) |
    | void | write(char[] c, int off, int len) |
    | void | write(String str) |
    | void | write(String str, int off, int len) |

- 버퍼에 잔류하는 모든 문자열을 출력하는 `flush()` 추상 메소드가 정의되어 있다.

- 사용한 시스템 자원 반납 후 출력 스트림을 닫는 `close()` 추상 메소드가 정의되어 있다.

## 파일 관련 입출력 스트림

### File 클래스

- java에서 파일을 관리하는 데 사용하는 클래스이다.
    - 파일의 크기, 속성, 이름 등의 정보를 얻어내는 메소드(기능)를 제공한다.
    - 파일의 생성과 삭제하는 기능을 제공한다.

- 파일 내부 데이터를 읽고 쓰기는 불가능하다
    - 이건 입출력 스트림을 이용해야 함

- File 객체를 만들면, 파일 관리가 가능하다.

- new로 객체를 만들면, heap 메모리 상에만 존재하는 객체이다.
    - `.createNewFile()` 메소드로 실행해야 물리적인 파일이 생성된다.

    ```java
    try {
        File file = new File("test.txt"); 
        file.createNewFile();   // 실행 시 물리적인 파일이 생성된다.
    } catch (IOException e) {
        e.printStackTrace();
    }
    ```
    - 입출력 관련된 코드라서 예외처리가 필요하다. 
    - `try-catch`로 둘러싸면 됨


#### 관련 메소드

1. `.createNewFile()`: 물리적인 파일 생성
    - 존재하지 않는 경로를 제시하면 `IOException`을 발생

2. `.delete()`: 파일 또는 디렉터리를 삭제

3. `.getName()`: 파일 이름을 조회

4. `.getAbsolutePath()`: 파일의 경로를 조회

5. `.length()`: 파일 길이( = 파일 용량)을 확인

6. `.exists()`: 파일이 존재하는지 여부를 확인

7. `.isFile()` / `.isDirectory()`: 파일 또는 디렉터리 여부를 확인

8. `.mkdir()` / `.mkdirs()`: 폴더(디렉터리)를 생성
   - `mkdirs()`는 경로상에 없는 모든 폴더를 생성해 준다

### FileOutputStream

- OutputStream의 하위 클래스로 바이트 단위로 데이터를 파일에 출력하는 클래스이다.
    - FileOutputStream은 그림, 오디오, 비디오, 텍스트 파일 등 모든 종류의 파일로 저장이 가능하다.

- FileOutputStream 객체가 생성될 때 파일과 직접 연결된다.

    ```java
    FileOutputStream fos = new FileOutputStream("a_byte.dat");
    FileOutputStream fos = new FileOutputStream("a_byte.dat", true);
    ```

    - 실제 파일이 존재하지 않으면 자동으로 생성하지만 이미 파일이 존재하는 경우 파일을 덮어쓴다.
    - 이미 존재하는 파일에 이어서 계속 작성하고 싶다면 2번째 매개값으로 `true`를 전달한다.


#### `.write()`

- OutputStream 추상 클래스를 상속받아 `.write()` 메소드를 상속한다.
    - 어떤 스트림을 이용해도 전부 같은 방식으로 사용한다.

    ```java        
    FileOutputStream fos = new FileOutputStream("a_byte.dat");
    fos.write(97);  // ASCII 기준 'a'            
    fos.write('b');  // char는 형변환되어서 넘어감 -> 98
    fos.write(10);  // 줄바꿈 문자
    fos.write('가');  // 한글을 2바이트라서 바이트 단위 스트림으로는 제대로 출력할 수 없다. -> 파일 깨짐
    ```

- 바이트 배열을 만든 뒤 배열 값을 한번에 출력할 수도 있다.
    ```java
    byte[] values = {99, 100, 101, 102, 103};
    fos.write(10);  // cdefg
    fos.write(values, 1, 2);  // de
    ```
    - int 2개를 추가로 주면 offset, length로, 배열의 특정 인덱스부터 n개의 문자만 넣는다.

- `.flush()`를 이용해 버퍼에 잔류하는 모든 내용을 출력할 수 있다.
    - 가끔 쓰면 좋음

- `.close()`는 연결을 끊고, 사용하던 리소스를 모두 종료해주는 메소드
    ```java
    finally {
        try {
            fos.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    ```
    - 스트림 사용 시 마지막에 꼭 `.close()`로 종료해 주는 것이 좋다
    - 보통 `.write()`는 IOException 때문에 try-catch를 이용하는데, `try`에 `.close()`를 작성 시 에러가 발생했을 때 호출이 안될 수 있으므로 `.close()`는 `finally`에 작성한다.
    - 그런데 `.close()`에서도 에러가 날 수 있으므로 또 try-catch로 둘러싸 주어야 한다.

### FileInputStream

- InputStream의 하위 클래스로 파일로부터 바이트 단위로 데이터를 입력받는 클래스이다.
    - FileInputStream은 그림, 오디오, 비디오, 텍스트 파일 등 모든 종류의 파일의 읽기가 가능하다.
    
- FileInputStream 객체가 생성될 때 파일과 직접 연결된다.

    ```java
    FileInputStream fis = new FileInputStream("a_byte.dat");
    ``` 

    - 실제 파일이 존재하지 않으면 `FileNotFoundException`이 발생한다.
    
#### `.read()`

- InputStream 추상 클래스를 상속받아 `.read()` 메소드를 상속한다.
    - 어떤 스트림을 이용해도 전부 같은 방식으로 사용한다.

- `.read()`는 한번 읽을 때마다 다음 바이트를 가져온다.

    ```java
    FileInputStream fis = new FileInputStream("a_byte.dat");
    System.out.println(fis.read());         // 97
    System.out.println((char) fis.read());  // b
    System.out.println(fis.read());         // 10
    ```

- `.read()`는 바이트 데이터를 받아와서 int 형태로 출력한다.
    - int는 4바이트인데, 이 중 1바이트만 사용함
    - 출력된 값을 `char`로 형변환하면 문자형으로 볼 수도 있다.

- 배열을 이용할 수 있다.
    ```java
    byte[] buffer = new byte[50];
    System.out.println(fis.read(buffer, 5, 5));  // 5 -> 읽어온 바이트 수를 반환함
    System.out.println(Arrays.toString(buffer));  // [0, 0, 0, 0, 0, 10, 99, 100, 101, 102, 0, 0, ... , 0]
    ```

- 역시 스트림을 사용하므로 `.close()`를 이용해 종료해 주는 것이 좋다.

- 더 읽어올 데이터가 없으면 -1을 리턴한다.
    ```java
    fis = new FileInputStream("a_byte.dat");

    int value;
    while ((value = fis.read()) != -1) {
        System.out.println((char) value);
    }
    ```
    - 반복문을 통해 -1이 나올 때까지 계속 출력하면 파일 크기에 상관없이 전부 출력할 수 있다.

### FileWriter

- Writer의 하위 클래스로 문자 단위로 데이터를 텍스트 파일에 출력하는 클래스이다.
    - FileWriter는 텍스트가 아닌 그림, 오디오, 비디오 등의 파일에 저장이 불가능하다.
    
    ```java
    // FileWriter 객체가 생성될 때 파일과 직접 연결된다.
    FileWriter fw = new FileWriter("b_char.txt");
    FileWriter fw = new FileWriter("b_char.txt", true);
    ```
    - 실제 파일이 존재하지 않으면 자동으로 생성하지만 이미 파일이 존재하는 경우 파일을 덮어쓴다.
    - 이미 존재하는 파일에 이어서 계속 작성하고 싶다면 2번째 매개값으로 `true`를 전달한다.
    
- try-with-resources 구문
    ```java
    try (FileWriter fw = new FileWriter("b_char.txt")) {
        ...
    } catch (IOException e) {
        e.printStackTrace();
    }
    ```
    - try 구문에서 사용한 리소스를 자동으로 `.close()` 시킨다. 굳이 finally에 `close()`를 넣어서 try-catch를 또 작성하고 할 필요가 없다.
    - 이 구문을 사용하려면 클래스가 `AutoClosable`을 구현해야 한다.

- `.write()` 사용 방법은 `FileOutputStream`과 완전 똑같다.
    ```java
    fw.write('A');
    fw.write('가');  // 한글 출력 가능
    fw.write(new char[] {'a', 'p', 'p', 'l', 'e'});  // 문자 배열도 가능
    fw.write("apple\n");  // 문자열도 가능
    fw.write("안녕하세요. 저는 홍길동입니다. 만나서 반갑습니다.\n", 3, 8);
    ```
    - `FileOutputStream`과 달리 문자 단위로 출력하기 때문에, 한글도 출력할 수 있다.
    - 문자 배열, 문자열 모두 지원한다.
        - 문자열을 입력할 경우 문자열을 char 단위로 출력한다.
        - offset과 length도 지원한다.

### FileReader

- Reader의 하위 클래스로 텍스트 파일로부터 문자 단위로 데이터를 입력받는 클래스이다.
    - FileReader는 텍스트가 아닌 그림, 오디오, 비디오 등의 파일은 읽기가 불가능하다.
    
    ```java
    // FileReader 객체가 생성될 때 파일과 직접 연결된다.
    FileReader fr = new FileReader("C:/data/test.txt");
    ```
    - 실제 파일이 존재하지 않으면 `FileNotFoundException`이 발생한다.
    
- 출력 시 2바이트의 데이터(char)를 int에 넣어 리턴한다.
    - 문자 배열에 데이터를 읽어오는 건 가능하지만, 문자열로 입력받는건 지원하지 않는다.

- 반환값은 다르지만 `read()` 메소드의 사용법은 `FileInputStream`과 완전 똑같다.


## 보조 스트림

- 보조 스트림은 기반 스트림(InputStream, OutputStream, Reader, Writer)의 기능을 향상시키거나 새로운 기능을 추가하기 위해 사용한다.

- 보조 스트림은 실제 데이터를 주고받는 스트림이 아니기 때문에 입출력 처리 불가능하다.

- 보조 스트림은 반드시 기반 스트림(InputStream, OutputStream, Reader, Writer)을 먼저 생성한 후 이를 이용하여 보조 스트림 생성해야 한다.

### 문자 변환 보조 스트림

- 기반 스트림이 바이트 기반 스트림(InputStream, OutputStream)이지만 데이터가 문자일 경우에 사용한다.
    - 그냥 처음부터 문자 기반 스트림을 쓰면 되지만, 그럴 수 없을 경우 사용함(제공받는 스트림이 바이트 기반으로 들어올 경우)

#### InputStreamReader

InputStreamReader는 바이트 기반의 InputStream에 연결되어 문자 기반의 Reader로 변환하는 보조 스트림이다.

- `InputStreamReader` 생성자에 매개값으로 다른 바이트 기반 스트림을 넣어주면 된다.
- `System.in`도 키보드에서 읽어오는 InputStream 기반의 바이트 기반 스트림
    ```java
    InputStreamReader isr = new InputStreamReader(System.in);
    isr.read();  // 콘솔창에 키보드로 입력하는 내용을 읽어올 수 있다.
    ```
- `System.in`에는 `read()`가 구현되어 있지만, 바이트 기반임
- `System.in`을 `.close()`할경우 이후 키보드 입력이 막힌다.

#### OutputStreamWriter
OutputStreamWriter는 바이트 기반의 OutputStream에 연결되어 문자 기반의 Writer로 변환하는 보조 스트림이다.

- `System.out`은 `PrintStream`-`FilterOutputStream`-`OutputStream` 계통의 바이트 기반 스트림

    ```java
    OutputStreamWriter osw = new OutputStreamWriter(System.out);
    osw.write("안녕하세요. 곧 점심이네요. 오늘 점심은 뭘 먹을까요?");
    osw.flush();
    ```

- `System.out`에도 이미 `.write()`가 구현되어 있지만, 바이트 기반
    - 그냥 `print` 쓰는게 훨씬 편하다
- `System.out`도 `.close()`하면 안됨
    - 그래서 `.flush()`를 해야 출력 내용이 버퍼에서 출력창으로 출력된다.

### 성능 향상 보조 스트림

입출력 성능에 영향을 미치는 입출력 장치(하드디스크, 네트워크 등)를 이용하는 경우에 사용한다.

- 입출력 장치(하드디스크, 네트워크 등)와 직접 작업하지 않고 **버퍼(메모리)에 데이터를 모아 한 번에 입출력 작업**을 하여 실행 성능을 향상한다.

- BufferedInputStream 또는 BufferedReader는 외부의 입력 장치로부터 데이터를 직접 읽지 않고 버퍼에 쌓아두었다가 데이터를 한 번에 읽음으로써 읽기 성능을 향상시키는 보조 스트림이다.

- BufferedOutputStream 또는 BufferedWriter는 외부의 출력 장치로 데이터를 직접 출력하지 않고 버퍼에 쌓아두었다가 데이터를 한 번에 전송함으로써 출력 성능을 향상시키는 보조 스트림이다.

### 기본 타입 입출력 보조 스트림

- 입출력 장치로 기본 자료형의 데이터를 읽고 출력하는 경우에 사용한다.
- 단, 입력된 자료형의 순서와 출력될 자료형의 순서가 일치해야 한다.
- DataInputStream은 바이트 기반의 데이터를 기본 자료형의 데이터로 읽을 수 있는 보조 스트림이다.
- DataOutputStream은 바이트 기반의 데이터를 기본 자료형의 데이터로 출력할 수 있는 보조 스트림이다.

### 객체 입출력 보조 스트림

- 입출력 장치로 객체를 읽고 출력하는 경우에 사용한다.
- 단, 객체는 문자 데이터가 아니므로, 출력하거나 저장하려면 바이트 형태로 직렬화해야 한다.
    - 직렬화란 스트림을 통해서 객체를 출력하기 위해 연속적인 데이터로 변환하는 것을 말한다.
    - 역직렬화란 스트림을 통해서 읽어들인 연속적인 데이터를 객체로 복원하는 것을 말한다.
- ObjectInputStream은 InputStream에 연결되어 객체를 역직렬화하는 보조 스트림이다.
- ObjectOutputStream은 OutputStream에 연결되어 객체를 직렬화하는 보조 스트림이다.