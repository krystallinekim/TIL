# DB 모델링

## 1. 데이터 모델링

- 데이터 모델링은 업무보다는 데이터를 중심으로 모델링을 진행하는 방법이다.

- 데이터 모델링은 일반적으로 개념적 모델링, 논리적 모델링, 물리적 모델링 3가지 과정으로 분류된다.

- 개념적 모델링 + 논리적 모델링으로 ERD를 작성하고, 물리적 모델링으로 테이블 명세서를 작성함

## 2. 개념적 모델링

- 요구분석 단계에서 정의된 핵심 개체(Entity)와 그들 간의 관계(Relationship)를 바탕으로 ERD(Entity-Relationship Diagram)를 생성하는 단계이다.

- ERD는 피터 첸 표기법 / IE 표기법(까마귀발) 등으로 표현

- 엔티티와 관계 설정에 정답은 없다. 요구사항에 맞게 작성해야 한다.


### 2.1. 엔티티(Entity)

- 엔티티란 실제로 관리해야 할 구체적인 대상을 의미하며, 엔티티가 가지고 있는 특징(반드시 하나 이상 존재해야 한다)을 속성이라 한다.
- 유형/무형/문서 등등으로 분류

    | 엔티티 | | 속성 |
    | --- | --- | --- |
    |학생정보| <-> | 학번, 이름, 나이, ...|

### 2.2. 식별자

- 엔티티에 있는 데이터들을 서로 구분을 해 줄 수 있는 속성을 주 식별자(Primary Key)라 한다.
  - 중복값을 가질 수 없다.
  - 반드시 값이 존재해야 함(NULL 불가)
  - 최소한의 속성으로 구성하고, 가능한 바뀌지 않는 것이 좋다

- 주 식별자를 대체할 수 있는 또 다른 속성을 보조 식별자(Unique Key)라 한다.
  - 중복값은 불가, 빈값은 존재 가능함

- 엔티티와의 관계를 연결해 주는 식별자를 외부 식별자(Foreign Key)라 한다.

### 2.3. 관계(Relationship)

- 일단 1:1, 1:M, M:M 3가지가 존재함
- 관계도에서 1일 경우 직선으로 연결되고, M일 경우는 까마귀발로 연결됨    

#### 일대일 관계

- A 엔티티에 존재하는 1건의 데이터와 대응되는 B 엔티티의 데이터도 1건일 경우 `일대일(1:1, One To One)` 관계라고 한다.
  - 학생(1) --- 학생정보(1), 학생 하나에는 학생정보 하나가 존재함
  - 보안 목적으로 하나의 테이블을 나눌 때가 많음

#### 일대다 관계

- A 엔티티에 존재하는 1건의 데이터와 대응되는 B 엔티티의 데이터가 여러 건일 경우 `일대다(1:M, One To Many)` 관계라고 한다.
  - 학과(1) ---< 학생(M), 하나의 학과에는 여러 학생이 존재 가능하지만, 한 학생은 여러 학과에 가지 않음(일단은)
  - 가장 일반적인 관계

#### 다대다 관계

- A 엔티티에 존재하는 여러 건의 데이터와 대응되는 B 엔티티의 데이터가 여러 건일 경우 `다대다(M:M, Many To Many)` 관계라고 한다.
  - 강의(M) >---< 학생(M), 한 강의에 여러 학생이 존재하고, 한 학생은 여러 강의를 들을 수 있다.
  - 실제 물리적으로 구현 불가능함(PK 제약조건 때문에) -> 직접 연결하는게 아니라, 중간에 엔티티를 하나 더 둬서 표현함.
    - 교차 엔티티에도 속성 추가 가능
    - 강의(M) >--- 수강신청(1) ---< 학생(M)


### 2.4. 식별, 비 식별 관계

- 식별 관계는 부모 엔티티(참조 대상)의 주 식별자를 자식 엔티티의 주 식별자이자 외래 식별자로 사용하는 관계다.
  - 자식 엔티티의 주식별자로 쓰이기 때문에, 값이 항상 존재해야 한다.
  - 주식별자는 여러 속성을 묶어서도 쓰이고, 외래식별자를 묶을 수도 있음
  - 묶을 경우, 나머지 2개가 같아도 하나만 다르면 개체가 만들어질 수 있다
    
- 비 식별 관계는 부모 엔티티의 주 식별자를 자식 엔티티의 외래 식별자로만 사용하는 관계다.
  - 이때는 자식 엔티티에서 값이 없어도 됨
    
- 점선, 혹은 실선을 이용해 엔티티 간에 식별관계를 표시함.
  - 실선이 식별관계, 점선이 비식별관계

- 일단 비식별관계로 만들어놓고, 필요할 경우 식별관계로 넘기는 게 편함


## 3. 논리적 모델링

- 개념적 모델링 과정에서 추상화된 데이터를 구체화하여 개체, 속성을 테이블화하고 상세화 하는 과정이다.

### 3.1. 이상 (Anomaly)

- **정규화를 진행하지 않은 엔티티**를 대상으로 삽입, 갱신, 삭제 시 발생할 수 있는 예기치 못한 현상을 `이상`이라고 한다.
- 이상에는 삽입 이상, 갱신 이상, 삭제 이상이 있다.

#### 삽입 이상
데이터 삽입 시 중복되거나, 입력되지 말아야 할 값이 같이 들어가는 문제

주문테이블에서,
- 주문에 대한 정보만 입력해도 제품에 대한 정보도 같이 입력해야 한다.
  - 같은 내용이 중복되어 들어감

- 제품에 대한 정보만 입력하고 싶을 때 주문에 대한 정보는 NULL 값을 가진다.
  - 주문테이블의 PK인 주문번호에 NULL값이 들어갈 수 있음. 제품정보를 입력하려면 가상의 주문번호를 입력하지 않는 이상 입력 불가
  
#### 갱신 이상(수정 이상)
수정/갱신 시 모든 데이터를 동시에 수정해야 하는 문제

- 동일한 제품명을 중복되어 있는 수만큼 수정해야 한다.
  - 한 번만 수정하거나 일부만 수정할 경우 일관성이 맞지 않는 문제가 발생한다.
    
#### 삭제 이상

삭제 시 원하지 않는 데이터도 같이 지워지는 문제

- 주문에 대한 정보(주문 번호, 주문 수량)를 삭제할 때 제품 번호, 제품명, 단가도 같이 삭제된다.
    

### 3.2. 정규화

하나의 테이블에 모든 데이터를 넣으면, 이상이 생기게 된다.

정규화는 하나의 엔티티를 여러 엔티티로 쪼개는 과정

제 1, 2, 3 정규화 이외에도 보이스코드 정규화, 제 4, 5정규화 등등 다양한 정규화가 존재

#### 제 1 정규화

- 하나의 속성이 하나의 값을 갖도록 한다.
  - 사원번호-취미 테이블에서, 한 줄에 사원번호-취미 하나씩 들어가도록

#### 제 2 정규화

- 주 식별자 전체에 종속적이지 않는 속성을 분리한다. (주 식별자가 복합 식별자일 경우)
  - 학번-강의이름(주식별자), 강의실, 성적 테이블에서
  - 강의이름과 강의실은 전체에 종속적이지 않아 따로 분리하는게 맞다

#### 제 3 정규화

- 주 식별자에 종속적이지 않고 다른 속성에 종속적인 속성을 분리한다.
  - 고객번호-등급-할인율 테이블에서
  - 할인율이 등급에 종속적이면 고객번호-등급 테이블과 등급-할인율 테이블로 분리
    

## 4. 물리적 모델링

### 4.1. 물리적 모델링

- 논리적 모델링 과정에서 표현된 데이터를 실제 데이터베이스에 맞도록 구현하는 과정이다.
    
    
    | 논리적 DB 설계 | 물리적 DB 설계 |
    | --- | --- |
    | 엔티티(Entity) | 테이블(Table) |
    | 속성(Attribute) | 컬럼(Column) |
    | 주 식별자(Primary Identifier) | 기본키(Primary Key) |
    | 보조 식별자(Unique Identifier) | UNIQUE 제약조건 |
    | 외래 식별자(Foreign Identifier) | 외래키(Foreign Key) |
    |  | 뷰(View) |
    |  | 인덱스(Index) |

- 엔티티의 속성은 모두 테이블의 컬럼으로 생성한다.
- 주 식별자는 모두 테이블의 Primary Key로 지정한다.
- 보조 식별자는 Unique Key로 지정한다.
- 외부 식별자는 Foreign Key로 지정한다.
- 추가로 필요한 객체(뷰, 인덱스 등)를 생성한다.

### 4.2. 반 정규화

- 반 정규화란 이름 그대로 정규화의 반대이다.
- A 테이블과 B 테이블이 있을 때, 두 테이블을 따로 분리해도 되고 합쳐도 되는 상황이라면 분리하는 것보다 합치는 것이 성능에 더 좋을 수 있다.
  - 엔티티가 쪼개져 있으면 계속 JOIN해서 조회해야 해서 쿼리가 복잡해지고, 귀찮아진다
  - 항상 A와 B가 JOIN해서만 써야 한다면 그냥 합쳐서 쓰자
- 대신 항상 이상이 생길 수 있다는 것을 유념